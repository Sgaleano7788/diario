<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calendario del Amor üíñ</title>
  <link rel="stylesheet" href="/static/style.css">

  <style>
    .month-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .month-navigation button {
      padding: 6px 12px;
      cursor: pointer;
      font-size: 1rem;
    }

    .month-title {
      text-align: center;
      flex-grow: 1;
      font-size: 1.5rem;
      font-weight: bold;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }

    .day-header {
      font-weight: bold;
      text-align: center;
    }

    .day {
      text-align: center;
      padding: 10px;
      border: 1px solid #ccc;
      cursor: pointer;
    }

    .day.has-memory {
      background-color: #ffe0e0;
      border: 1px solid #ff99aa;
    }

    .memory-card {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 10px;
      background-color: #fff0f5;
    }

    .memory-card img {
      max-width: 100%;
      display: block;
      margin-bottom: 6px;
      border-radius: 6px;
    }

    .download-btn {
      display: inline-block;
      margin-top: 6px;
      padding: 6px 14px;
      background-color: #ff5d8f;
      color: white;
      text-decoration: none;
      border-radius: 20px;
      font-size: 13px;
    }

    .download-btn:hover {
      background-color: #e0487d;
    }
  </style>
</head>

<body>

<h1>üìÖ Nuestro Calendario de Recuerdos</h1>

<!-- ‚ûï Volver al √°lbum -->
<button class="back-btn" onclick="goToIndex()">‚ûï Agregar m√°s recuerdos</button>

<!-- üéµ M√∫sica del calendario -->
<audio id="calendar-music" loop>
  <source src="/static/audio/musica2.mp3" type="audio/mpeg">
  Tu navegador no soporta audio
</audio>

<button id="calendarMusicBtn" class="music-btn">
  üéµ Reproducir m√∫sica
</button>

<div class="calendar-container">
  <div class="month-navigation">
    <button id="prev-month">‚¨ÖÔ∏è</button>
    <div class="month-title" id="month-title"></div>
    <button id="next-month">‚û°Ô∏è</button>
  </div>

  <div id="calendar"></div>
</div>

<h2 id="selected-date">Selecciona un d√≠a üíï</h2>
<div id="memories"></div>

<script>
let recuerdosPorFecha = {};
let currentDate = new Date();

// ‚ûï Volver al index
function goToIndex() {
  window.location.href = "/index";
}

// üéµ M√∫sica
const calendarMusic = document.getElementById("calendar-music");
const calendarMusicBtn = document.getElementById("calendarMusicBtn");

calendarMusic.volume = 0.25;

calendarMusicBtn.addEventListener("click", () => {
  calendarMusic.play()
    .then(() => {
      calendarMusicBtn.innerText = "üéµ M√∫sica sonando...";
      calendarMusicBtn.disabled = true;
    })
    .catch(() => {
      alert("El navegador bloque√≥ la m√∫sica üò¢");
    });
});

// 1Ô∏è‚É£ Cargar recuerdos
fetch("/recuerdos")
  .then(res => res.json())
  .then(data => {
    data.forEach(r => {
      if (!recuerdosPorFecha[r.fecha]) {
        recuerdosPorFecha[r.fecha] = [];
      }
      recuerdosPorFecha[r.fecha].push(r);
    });
    renderCalendar(currentDate);
  });

// 2Ô∏è‚É£ Render calendario
function renderCalendar(date) {
  const calendar = document.getElementById("calendar");
  calendar.innerHTML = "";

  const year = date.getFullYear();
  const month = date.getMonth();

  document.getElementById("month-title").textContent =
    date.toLocaleDateString("es-ES", { month: "long", year: "numeric" });

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  const grid = document.createElement("div");
  grid.className = "calendar-grid";

  ["Dom","Lun","Mar","Mi√©","Jue","Vie","S√°b"].forEach(d => {
    const h = document.createElement("div");
    h.className = "day-header";
    h.textContent = d;
    grid.appendChild(h);
  });

  for (let i = 0; i < firstDay; i++) grid.appendChild(document.createElement("div"));

  for (let day = 1; day <= daysInMonth; day++) {
    const cell = document.createElement("div");
    cell.className = "day";

    const fecha = `${year}-${String(month + 1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
    cell.textContent = day;

    if (recuerdosPorFecha[fecha]) cell.classList.add("has-memory");

    cell.onclick = () => showMemories(fecha);
    grid.appendChild(cell);
  }

  calendar.appendChild(grid);
}

// 3Ô∏è‚É£ Mostrar recuerdos (con descarga)
function showMemories(fecha) {
  const container = document.getElementById("memories");
  document.getElementById("selected-date").textContent = `üíñ Recuerdos del ${fecha}`;
  container.innerHTML = "";

  const recuerdos = recuerdosPorFecha[fecha];

  if (!recuerdos) {
    container.innerHTML = "<p>No hay recuerdos este d√≠a üíî</p>";
    return;
  }

  recuerdos.forEach(r => {
    const card = document.createElement("div");
    card.className = "memory-card";

    card.innerHTML = `
      <span class="heart">‚ù§Ô∏è</span>
      ${r.image ? `<img src="${r.image}">` : ""}
      <p>${r.nota || ""}</p>
      ${r.image ? `
        <a href="${r.image}" download class="download-btn">
          ‚¨á Descargar recuerdo
        </a>
      ` : ""}
    `;

    container.appendChild(card);
  });
}

// 4Ô∏è‚É£ Navegaci√≥n
document.getElementById("prev-month").onclick = () => {
  currentDate.setMonth(currentDate.getMonth() - 1);
  renderCalendar(currentDate);
};

document.getElementById("next-month").onclick = () => {
  currentDate.setMonth(currentDate.getMonth() + 1);
  renderCalendar(currentDate);
};
</script>

</body>
</html>



